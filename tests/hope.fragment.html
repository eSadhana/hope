<!doctype html>
<html>
<head>
	<script type="text/javascript" src="../src/hope.js"></script>
	<script type="text/javascript" src="../src/hope.test.js"></script>
	<script type="text/javascript" src="../src/hope.range.js"></script>
	<script type="text/javascript" src="../src/hope.mime.js"></script>
	<script type="text/javascript" src="../src/hope.fragment.text.js"></script>
	<script type="text/javascript" src="../src/hope.fragment.annotations.js"></script>
	<script type="text/javascript" src="../src/hope.fragment.js"></script>

	<script type="text/javascript" src="../src/hope.parse.hope.js"></script>
	<script type="text/javascript" src="../src/hope.render.html.js"></script>
</head>
<body>
<div id="hopeTestOutput" style="white-space: pre"></div>
<script type="text/javascript">

	var test = hope.test.create();

	test.testParse = function() {
		var annotations = '0-10:h1\n12-20:p\n';
		var content = "Een kopje.\n\nEn tekst\n";
		var fragment = hope.fragment.create( content, annotations );
		var fragmentStr = fragment + '';
		var parsed = hope.fragment.parse( fragmentStr );
		test.assertTrue( ''+parsed.annotations == annotations );
		test.assertTrue( ''+parsed.content == content );
	}

	test.testCut = function() {
		var annotations = '0-10:h1\n12-20:p\n';
		var content = "Een kopje.\n\nEn tekst\n";
		var fragment = hope.fragment.create( content, annotations );
		var cut = fragment.cut( hope.range.create( 0, 4) );
		test.assertTrue( cut.content.length() == 4 );
		test.assertTrue( fragment.content.length() == ( content.length - 4 ) );
		var annotationsNew = '0-6:h1\n8-16:p\n';
		var contentNew = "kopje.\n\nEn tekst\n";
		test.assertTrue( ''+fragment.annotations == annotationsNew );
		test.assertTrue( ''+fragment.content == contentNew );
	}

	test.testPaste = function() {
		var annotations = '0-11:h1\n12-20:p\n';
		var content = "Een kopje.\n\nEn tekst\n";
		var fragment = hope.fragment.create( content, annotations );
		var pasteMarkup = '0-6:em';
		var pasteContent = 'schuin ';
		var cut = fragment.paste( hope.range.create(4,4), hope.fragment.create( pasteContent, pasteMarkup ) );
		var annotationsNew = '0-18:h1\n4-10:em\n19-27:p\n';
		var contentNew = "Een schuin kopje.\n\nEn tekst\n";
		test.assertTrue( ''+fragment.annotations == annotationsNew );
		test.assertTrue( ''+fragment.content == contentNew );
//		document.write( hope.render.html.render( fragment.content+'', fragment.annotations+'') );
	}

	test.testPasteStr = function() {
		var annotations = '0-11:h1\n12-20:p\n';
		var content = "Een kopje.\n\nEn tekst\n";
		var fragment = hope.fragment.create( content, annotations );
		var pasteContent = 'schuin ';
		var cut = fragment.paste( hope.range.create(4,4), pasteContent );
		var annotationsNew = '0-18:h1\n19-27:p\n';
		var contentNew = "Een schuin kopje.\n\nEn tekst\n";
		test.assertTrue( ''+fragment.annotations == annotationsNew );
		test.assertTrue( ''+fragment.content == contentNew );
	}

	test.run();

</script>
</body>
</html>
